pipeline{
    agent any{
        GIT_BRANCH = sh(script: "git rev-parse --abbrev-ref HEAD" , returnStdout:true).trim()
    }
    stages{
        stage("checkout code"){
            steps{

                git "<url>"
            }
        }
        stage('Build docker image'){
            steps{
                script{
                    sh 'docker build -t <docke image name>'
                    sh 'docker images'
                }
            }
        }
        stage("Docker Push"){
            steps{
                script{
                    withCredentials([string(credentialsId: "dockerpass" , variable : "dockerPasswrod")]){
                        sh 'docker login -u <dockerhub username> -p ${dockerPassword}'
                        sh 'docker push <docker image name>'
                    }
                }
            }
        }
        stage("docker deploy"){
            steps{
                script{
                    sh 'docker pull <image name>'
                    sh 'docker stop image<shortname>||true'
                    sh 'docker rm image<shortname>||true'
                    sh 'docker run -itd --name image<shortname> -p 3000:80 <image name>'
                }
            }
        }
    }
    post{
        success{
            slackSend channel: '<channel name>',
            attachments : [
                [
                    color:"good",
                    title:"Build SUCCESSFULL",
                    texT:"build #${env.BUILD_NUMBER} has completed :white_check_mark:",
                    feilds: [
                        [title:"Project" , value"${env.JOB_NAME}" , short:true],
                        [title:"Branch" , value:"${env.GIT_BRANCH}" , short:true]
                    ],
                    footer:"JENKINS CI/CD PIPELINE",
                    ts:System.currentTimeMillis()/1000
                ]
            ]
        }
        failure{
            slackSend channel:"<channel name>",
            attachments:[
                [
                    color:"danger",
                    title:"Build failed",
                    text:"Build  #${env.BUILD_NUMBER} has failed :x: <!here>",
                    feilds:[
                        [title:"Project" , value"${env.JOB_NAME}" , short:true],
                        [title:"Branch" , value:"${env.GIT_BRANCH}" , short:true]
                    ]
                    footer:"JENKINS CI/CD PIPELINE",
                    ts:System.currentTimeMillis()/1000
                ]
            ]
        }

    }
}